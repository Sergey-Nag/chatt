(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{29:function(e,t,a){e.exports={time:"MessageBox_time__1amKO",system:"MessageBox_system__2871Y",message:"MessageBox_message__6lLNX",messageBox:"MessageBox_messageBox__1uNVV",right:"MessageBox_right__2tdT1",left:"MessageBox_left__2dMyd"}},31:function(e,t,a){e.exports={link:"ListCard_link__2li7z",row:"ListCard_row__R_5PR",time:"ListCard_time__uVD_M",name:"ListCard_name__3VpCW"}},38:function(e,t,a){e.exports={editor:"FormatTextEditor_editor__2v75u"}},39:function(e,t,a){e.exports={wrapp:"ChatLayout_wrapp__3MyNo"}},46:function(e,t,a){},48:function(e,t,a){},56:function(e,t,a){"use strict";a.r(t);var c=a(7),n=a.n(c),s=a(36),r=a.n(s),i=a(24),l=(a(46),a(0)),o=a.n(l),u=a(2),j=a(8),b=a(12),d=(a(48),a(9)),m=a(15),h=a(4),O=a(5),f=a(17),x=function e(t,a){var c,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(Object(h.a)(this,e),"object"===typeof t)?(t.text=t.textMarkup?t.text.trim():t.textMarkup=t.text.trim(),this.from=t.from,this.text=t.text,this.textMarkup=t.textMarkup.trim(),this.timestamp=null!==(c=t.timestamp)&&void 0!==c?c:Date.now()):(a=n?a.trim():n=a.trim(),this.from=t,this.text=a,this.textMarkup=n.trim(),this.timestamp=null!==s&&void 0!==s?s:Date.now())},v=function(){function e(t){Object(h.a)(this,e),this._app=t}return Object(O.a)(e,[{key:"_getDb",value:function(){return Object(f.c)(this._app)}},{key:"_getDbRef",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return f.j.apply(void 0,[this._getDb()].concat(t))}},{key:"getData",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=this._getDbRef(),e.next=4,Object(f.b)(Object(f.a)(a,t));case 4:return c=e.sent,e.abrupt("return",c.val());case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"writeData",value:function(e,t){try{var a=this._getDb();Object(f.l)(Object(f.j)(a,e),t)}catch(c){return null}}},{key:"listenData",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=a.limit,n=void 0===c?null:c,s=this._getDbRef(e),r=n?Object(f.i)(s,Object(f.g)(),Object(f.d)(n)):Object(f.i)(s);return Object(f.f)(r,(function(e){return t(e.val())})),function(){return Object(f.e)(s)}}},{key:"updateData",value:function(){var e=Object(u.a)(o.a.mark((function e(t,a){var c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=this._getDbRef(t),e.next=3,Object(f.k)(c,a);case 3:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"createChatBetween",value:function(e,t){var a=Date.now(),c=a.toString(36),n=new x("system","chat created");return this.writeData("chatsMeta/".concat(c),{chatBetween:[e,t],createdAt:a,lastMessage:n}),this.pushMessageToChat(c,n),this.updateData("users/".concat(e,"/chats"),this._addFieldToArr(c)),this.updateData("users/".concat(t,"/chats"),this._addFieldToArr(c)),c}},{key:"pushMessageToChat",value:function(e,t){var a=this;try{var c=this._getDbRef("chatsMessages/".concat(e)),n=Object(f.h)(c);Object(f.l)(n,t).then((function(){a.writeData("chatsMeta/".concat(e,"/lastMessage"),t)}))}catch(s){console.log(s)}}},{key:"_addFieldToArr",value:function(e){return function(t){return Array.isArray(t)&&!t.includes(e)?[].concat(Object(m.a)(t),[e]):Array.isArray(t)?void 0:[e]}}}]),e}(),p=new v,g=function(e){return p.updateData("users/".concat(e.nickname),(function(t){return Object(d.a)(Object(d.a)({},t),e)})),localStorage.setItem("user",JSON.stringify(e)),{type:"auth",payload:e.nickname}},y={authState:localStorage.getItem("user")?2:0,user:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,nickname:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).nickname:null},k=Object(c.createContext)(y),N=function(e,t){var a=t.type,c=t.payload;switch(a){case"auth":return Object(d.a)(Object(d.a)({},e),{},{nickname:c,authState:1});case"user/set":return Object(d.a)(Object(d.a)({},e),{},{user:c,authState:2});case"user/remove":return Object(d.a)(Object(d.a)({},e),{},{user:null,nickname:null,authState:0});default:return e}};function w(e,t){return t?Object.keys(e).map((function(t){return Object(d.a)(Object(d.a)({},e[t]),{},{key:t})})):Object.values(e)}var _=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.filterCallback,n=void 0===a?null:a,s=t.startListen,r=void 0===s?null:s,i=t.limit,l=void 0===i?null:i,o=t.saveKey,u=void 0!==o&&o,b=Object(c.useState)(null),d=Object(j.a)(b,2),m=d[0],h=d[1];return Object(c.useEffect)((function(){if(null===r||r){var t=p.listenData(e,(function(e){if(null!==e){var t=e;n&&(t=w(t,u).filter(n)),h(t)}}),{limit:l});return function(){return t()}}}),[e,n,r,l,u]),[m]},M=a(27),C=function(e){var t=e.providerData,a=e.metadata,c=e.email;return Object(d.a)(Object(d.a)({},t[0]),{},{nickname:c.split("@")[0].replace(/\./g,""),lastLoginAt:a.lastLoginAt})},S=a(6);function A(){var e=Object(c.useContext)(k),t=Object(j.a)(e,2),a=t[0],n=t[1],s=Object(c.useCallback)(Object(u.a)(o.a.mark((function e(){var t,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(M.b)(),a=new M.a,e.prev=2,e.next=5,Object(M.c)(t,a);case 5:c=e.sent,n(g(C(c.user))),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])}))),[n]);return Object(c.useEffect)((function(){document.title="Auth"}),[]),2===a.authState?Object(S.jsx)(b.a,{to:"/chat"}):Object(S.jsx)("div",{className:"d-flex align-items-center justify-content-center",style:{height:"100vh"},children:Object(S.jsxs)("button",{onClick:s,className:"btn btn-primary btn-lg",children:[Object(S.jsx)("i",{className:"bi bi-google"})," ","Sign In"]})})}function L(e){var t=e.isAside,a=e.setAside,n=Object(c.useContext)(k),s=Object(j.a)(n,2),r=s[0].user,i=s[1],l=Object(c.useState)(!1),o=Object(j.a)(l,1)[0],u=Object(c.useMemo)((function(){return[r.photoURL,r.displayName]}),[r]),b=Object(j.a)(u,2),d=b[0],m=b[1];return Object(S.jsx)("nav",{className:"navbar navbar-light bg-light",children:Object(S.jsxs)("div",{className:"container",children:[Object(S.jsx)("div",{className:"col-".concat(t?3:1," text-start"),children:Object(S.jsx)("button",{className:"navbar-toggler",type:"button",onClick:function(){return a(!t)},children:Object(S.jsx)("span",{className:"navbar-toggler-icon"})})}),Object(S.jsxs)("div",{className:"col d-flex justify-content-".concat(o?"between":"end"),children:[o&&Object(S.jsxs)("span",{className:"ms-2",children:[Object(S.jsx)("img",{src:o.profile_picture,alt:"",width:"30",height:"30",className:"d-inline-block align-text-top rounded"}),Object(S.jsx)("span",{className:"mx-3 align-middle",children:Object(S.jsx)("b",{children:o.username})})]}),Object(S.jsxs)("span",{className:"ms-5",children:[Object(S.jsx)("span",{className:"mx-3 align-middle",children:Object(S.jsx)("b",{children:m})}),Object(S.jsx)("img",{src:d,alt:"",width:"30",height:"30",className:"d-inline-block align-text-top rounded"}),Object(S.jsxs)("div",{className:"btn-group ms-3",children:[Object(S.jsx)("button",{className:"btn btn-sm dropdown-toggle",type:"button","data-bs-toggle":"dropdown",id:"settingsList","aria-expanded":"false",children:Object(S.jsx)("i",{className:"bi bi-gear"})}),Object(S.jsx)("ul",{className:"dropdown-menu dropdown-menu-end",children:Object(S.jsx)("li",{children:Object(S.jsx)("a",{className:"dropdown-item",href:"#",onClick:function(){return i((localStorage.removeItem("user"),{type:"user/remove"}))},children:"Logout"})})})]})]})]})]})})}var D=a(28),I=a.n(D),B=function(e){var t=I()(e),a=I()();return a.isAfter(t,"date")?a.to(t):t.format("HH:mm")},E=function(e){return I()(e).format("DD.MM.YY HH:mm")},H=a(31),T=a.n(H),R=a(23),F=a.n(R);function U(e){var t=e.photo,a=e.text,n=e.time,s=e.link,r=e.title,l=Object(c.useState)(B(n)),o=Object(j.a)(l,2),u=o[0],b=o[1];return Object(c.useEffect)((function(){b(B(n))}),[n]),Object(S.jsx)(i.b,{to:s,className:T.a.link,title:r,children:Object(S.jsx)("div",{className:"card ms-2 pe-3 mb-2",children:Object(S.jsxs)("div",{className:"row align-center flex-nowrap",children:[Object(S.jsx)("div",{className:"col-3 p-0",children:Object(S.jsx)("img",{src:t,className:"w-100 rounded-start",alt:""})}),Object(S.jsxs)("div",{className:"col d-flex justify-content-between align-self-center align-items-baseline overflow-hidden",children:[Object(S.jsx)("span",{className:F()(T.a.name,"col","text-start","system"===r&&T.a.time),children:a}),Object(S.jsx)("span",{className:F()(T.a.time,"col","text-end"),children:u})]})]})})})}function Y(){var e,t=Object(c.useContext)(k),a=Object(j.a)(t,1)[0].user,n=_("users",{filterCallback:Object(c.useCallback)((function(e){var t=e.uid,c=e.chats;return t!==a.uid&&!c||c&&a.chats&&!(null===c||void 0===c?void 0:c.some((function(e){return a.chats.includes(e)})))}),[a])}),s=Object(j.a)(n,1)[0];return Object(S.jsxs)("div",{className:"bg-white py-3",children:[Object(S.jsxs)("span",{className:"text-muted",children:["Users: ",null!==(e=null===s||void 0===s?void 0:s.length)&&void 0!==e?e:0]}),s&&s.length>0&&s.map((function(e){var t=e.uid,a=e.nickname,c=e.displayName,n=e.photoURL,s=e.lastLoginAt;return Object(S.jsx)(U,{text:c,time:+s,photo:n,link:"new?user=".concat(a)},t)}))]})}function K(e){var t=e.chatId,a=e.nickname,n=_("chatsMeta/".concat(t)),s=Object(j.a)(n,1)[0],r=Object(c.useState)(null),i=Object(j.a)(r,2),l=i[0],b=i[1],d=Object(c.useMemo)((function(){var e,t=function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.chatBetween.find((function(e){return e!==a})))&&void 0!==t?t:a};return[(null===s||void 0===s?void 0:s.lastMessage.from)||t(s),null===s||void 0===s?void 0:s.lastMessage.text,null!==(e=null===s||void 0===s?void 0:s.lastMessage.timestamp)&&void 0!==e?e:null===s||void 0===s?void 0:s.createdAt,t(s)]}),[s,a]),m=Object(j.a)(d,4),h=m[0],O=m[1],f=m[2],x=m[3];return Object(c.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getData("users/".concat(x,"/photoURL"));case 2:t=e.sent,b(t);case 4:case"end":return e.stop()}}),e)})))()}),[x]),Object(S.jsx)(S.Fragment,{children:s&&Object(S.jsx)(U,{text:O||h,time:f,link:t,title:h,photo:null!==l&&void 0!==l?l:""})})}function J(){var e,t,a=Object(c.useContext)(k),n=Object(j.a)(a,1)[0].user;return Object(S.jsxs)("div",{className:"bg-white h-100 py-3",children:[Object(S.jsxs)("span",{className:"text-muted",children:["Chats: ",null!==(e=null===(t=n.chats)||void 0===t?void 0:t.length)&&void 0!==e?e:0]}),n.chats&&n.chats.map((function(e){return Object(S.jsx)(K,{chatId:e,nickname:n.nickname},e)}))]})}function P(){return Object(S.jsxs)("div",{className:"py-3 text-start",children:[Object(S.jsx)(Y,{}),Object(S.jsx)("hr",{className:"m-0"}),Object(S.jsx)(J,{})]})}function V(){var e=Object(c.useState)(!0),t=Object(j.a)(e,2),a=t[0],n=t[1];return Object(c.useEffect)((function(){document.title="Chat"}),[]),Object(S.jsxs)("div",{children:[Object(S.jsx)(L,{isAside:a,setAside:n}),Object(S.jsx)("div",{className:"container",style:{height:"calc(100vh - 56px)"},children:Object(S.jsxs)("div",{className:"row h-100",children:[a&&Object(S.jsx)("div",{className:"col-3 h-100",children:Object(S.jsx)(P,{})}),Object(S.jsx)("div",{className:"col h-100",children:Object(S.jsx)(b.b,{})})]})})]})}function q(){var e=Object(c.useContext)(k);return 0===Object(j.a)(e,1)[0].authState?Object(S.jsx)(b.a,{to:"/auth"}):Object(S.jsx)(b.b,{})}var W=a(37);function z(){var e=Object(b.g)().search,t=Object(c.useState)(null),a=Object(j.a)(t,2),n=a[0],s=a[1],r=Object(c.useMemo)((function(){return new URLSearchParams(e).get("user")}),[e]),i=Object(W.useContext)(k),l=Object(j.a)(i,1)[0].user;return Object(c.useEffect)((function(){r&&s(p.createChatBetween(l.nickname,r))}),[l,r]),n&&Object(S.jsx)(b.a,{to:"/chat/"+n,replace:!0})}var X=a(38),G=a.n(X);function Q(e){var t=e.label,a=e.onChange,n=e.isClear,s=e.onEnterHotKey,r=Object(c.useRef)(null),i=Object(c.useCallback)((function(e){var t=e.target,c=e.shiftKey,n=e.keyCode,r=t.textContent,i=t.innerHTML;a({textContent:r,innerHTML:i}),c||13!==n||s()}),[a,s]);return Object(c.useEffect)((function(){r.current.innerHTML=""}),[n]),Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("div",{ref:r,role:"textbox",contentEditable:!0,className:F()("form-control perfect-scroll",G.a.editor),onKeyUp:i}),Object(S.jsx)("label",{children:t})]})}function Z(e){var t=e.chatId,a=Object(c.useContext)(k),n=Object(j.a)(a,1)[0].user,s=Object(c.useState)(""),r=Object(j.a)(s,2),i=r[0],l=r[1],o=Object(c.useState)(""),u=Object(j.a)(o,2),b=u[0],d=u[1],m=Object(c.useState)(!1),h=Object(j.a)(m,2),O=h[0],f=h[1],v=Object(c.useCallback)((function(){if(n&&i&&b){var e=new x(n.nickname,i,b);p.pushMessageToChat(t,e),f(!O)}}),[t,n,b,i,O]),g=Object(c.useCallback)((function(){v(i),l("")}),[i,v]),y=Object(c.useCallback)((function(e){var t=e.textContent,a=e.innerHTML;l(t),d(a)}),[]);return Object(S.jsxs)("div",{className:"p-3",children:[Object(S.jsx)("div",{className:"form-floating",children:Object(S.jsx)(Q,{label:"Your message",onChange:y,isClear:O,onEnterHotKey:g})}),Object(S.jsx)("div",{className:"form-group",children:Object(S.jsxs)("div",{className:"row pt-3",children:[Object(S.jsx)("div",{className:"col-7 text-start",children:Object(S.jsx)("div",{className:"btn-group",role:"group","aria-label":"Basic outlined example"})}),Object(S.jsx)("div",{className:"col-5 d-grid",children:Object(S.jsx)("button",{className:"btn btn-primary",onClick:g,children:"Send"})})]})})]})}var $=a(39),ee=a.n($),te=a(29),ae=a.n(te);function ce(e){var t=e.markup,a=e.from,n=e.isUser,s=e.time,r=e.setLastMsg,i=Object(c.useState)(E(s)),l=Object(j.a)(i,2),o=l[0],u=l[1];return Object(c.useEffect)((function(){u("system"===a?E(s):function(e){var t=I()(e),a=I()();return t.isAfter(a,"date")?t.format("DD.MM HH:mm"):t.format("HH:mm")}(s))}),[a,s]),Object(S.jsxs)("div",{className:"d-flex m-3 justify-content-".concat(n?"end":"start"),ref:function(e){return r(e)},children:["system"===a&&Object(S.jsx)("div",{title:o,className:ae.a.system,children:t}),"system"!==a&&Object(S.jsx)("div",{className:F()(ae.a.messageBox,ae.a[n?"right":"left"],"card px-3 p-2"),children:Object(S.jsx)("div",{className:"row",children:Object(S.jsxs)("div",{className:F()("col",n?"text-end":"text-start"),children:[Object(S.jsx)("p",{className:ae.a.message,dangerouslySetInnerHTML:{__html:t}}),Object(S.jsx)("span",{className:F()("text-secondary",ae.a.time),children:o})]})})})]})}function ne(e){var t=e.messages,a=Object(c.useContext)(k),n=Object(j.a)(a,1)[0].user,s=Object(c.useState)([]),r=Object(j.a)(s,2),i=r[0],l=r[1],o=Object(c.useState)(null),u=Object(j.a)(o,2),b=u[0],d=u[1];return Object(c.useEffect)((function(){t&&l(w(t).map((function(e){return new x(e)})))}),[t]),Object(c.useEffect)((function(){b&&b.scrollIntoView({behavior:"smooth"})}),[b]),Object(S.jsx)("div",{className:"flex-grow-1 overflow-auto bg-light perfect-scroll",children:i&&i.map((function(e){return Object(S.jsx)(ce,{markup:e.textMarkup,from:e.from,isUser:e.from===n.nickname,time:e.timestamp,setLastMsg:d},e.timestamp)}))})}function se(){var e=Object(b.i)().chatId,t=_("chatsMessages/".concat(e),{limit:50}),a=Object(j.a)(t,1)[0];return Object(S.jsxs)("div",{className:ee.a.wrapp,children:[Object(S.jsx)(ne,{messages:a}),Object(S.jsx)(Z,{chatId:e})]})}function re(){return Object(S.jsx)("div",{className:"d-flex justify-content-center align-items-center h-100 text-muted bg-light",children:Object(S.jsx)("h1",{children:"Choose a chat"})})}var ie=function(){var e=Object(c.useReducer)(N,y),t=Object(j.a)(e,2),a=t[0],n=t[1],s=_("/users/".concat(a.nickname),{startListen:0!==a.authState}),r=Object(j.a)(s,1)[0],i=Object(c.useCallback)(function(){var e=Object(u.a)(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:a=e.sent,n(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return Object(c.useEffect)((function(){r&&n({type:"user/set",payload:r})}),[r]),Object(S.jsx)("div",{className:"App",children:Object(S.jsx)(k.Provider,{value:[a,n,i],children:Object(S.jsxs)(b.e,{children:[Object(S.jsx)(b.c,{index:!0,element:r?Object(S.jsx)(b.a,{to:"chat"}):Object(S.jsx)(b.a,{to:"auth"})}),Object(S.jsx)(b.c,{path:"auth",element:Object(S.jsx)(A,{})}),Object(S.jsx)(b.c,{element:Object(S.jsx)(q,{}),children:Object(S.jsxs)(b.c,{path:"chat",element:Object(S.jsx)(V,{}),children:[Object(S.jsx)(b.c,{index:!0,element:Object(S.jsx)(re,{})}),Object(S.jsx)(b.c,{path:"new",element:Object(S.jsx)(z,{})}),Object(S.jsx)(b.c,{path:":chatId",element:Object(S.jsx)(se,{})})]})})]})})})},le=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,59)).then((function(t){var a=t.getCLS,c=t.getFID,n=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),c(e),n(e),s(e),r(e)}))},oe=a(40),ue=(a(53),a(33)),je={apiKey:"1:30750907257:web:83477b7c60c1800f42ada8",authDomain:"reactchat-15063.firebaseapp.com",projectId:"reactchat-15063",storageBucket:"reactchat-15063.appspot.com",messagingSenderId:"30750907257",databaseURL:"https://reactchat-15063-default-rtdb.firebaseio.com/",appId:"1:30750907257:web:83477b7c60c1800f42ada8"};localStorage.setItem("data",JSON.stringify(Object(d.a)(Object(d.a)({},je),{},{recaptcha:"6Ldc6pMdAAAAAIWHMO1f1oY4YqS8A2LtBxaMvqf8"})));var be=Object(oe.a)(je),de=Object(ue.c)(be,{provider:new ue.a("6Ldc6pMdAAAAAIWHMO1f1oY4YqS8A2LtBxaMvqf8"),isTokenAutoRefreshEnabled:!0});Object(ue.b)(de).catch((function(e){return console.log(e)}));a(54),a(55);var me=i.a;r.a.render(Object(S.jsx)(n.a.StrictMode,{children:Object(S.jsx)(me,{children:Object(S.jsx)(ie,{})})}),document.getElementById("root")),le()}},[[56,1,2]]]);
//# sourceMappingURL=main.15e67adc.chunk.js.map